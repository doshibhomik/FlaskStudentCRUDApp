<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student CRUD App</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">Student CRUD App</h1>

        <!-- Form for creating/updating a student -->
        <div class="card mb-4">
            <div class="card-header">Add/Update Student</div>
            <div class="card-body">
                <form id="student-form">
                    <input type="hidden" id="student_id">
                    <div class="form-group">
                        <label for="first_name">First Name</label>
                        <input type="text" id="first_name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="last_name">Last Name</label>
                        <input type="text" id="last_name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="dob">Date of Birth</label>
                        <input type="date" id="dob" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="amount_due">Amount Due</label>
                        <input type="number" id="amount_due" class="form-control" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Save</button>
                    <button type="button" id="cancel-update" class="btn btn-secondary">Cancel</button>
                </form>
            </div>
        </div>

        <!-- Table for displaying students -->
        <div class="card">
            <div class="card-header">Students List</div>
            <div class="card-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>First Name</th>
                            <th>Last Name</th>
                            <th>Date of Birth</th>
                            <th>Amount Due</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="students-list"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            loadStudents();

            // Load students from the backend
            function loadStudents() {
                $.ajax({
                    url: '/students',
                    method: 'GET',
                    success: function(data) {
                        var studentsList = $('#students-list');
                        studentsList.empty();
                        data.forEach(function(student) {
                            studentsList.append(`
                                <tr>
                                    <td>${student.student_id}</td>
                                    <td>${student.first_name}</td>
                                    <td>${student.last_name}</td>
                                    <td>${student.dob}</td>
                                    <td>${student.amount_due}</td>
                                    <td>
                                        <button class="btn btn-info btn-sm edit-student" data-id="${student.student_id}">Edit</button>
                                        <button class="btn btn-danger btn-sm delete-student" data-id="${student.student_id}">Delete</button>
                                    </td>
                                </tr>
                            `);
                        });
                    }
                });
            }

            // Handle form submission for adding/updating a student
            $('#student-form').submit(function(event) {
                event.preventDefault();
                var studentId = $('#student_id').val();
                var studentData = {
                    first_name: $('#first_name').val(),
                    last_name: $('#last_name').val(),
                    dob: $('#dob').val(),
                    amount_due: $('#amount_due').val()
                };
                if (studentId) {
                    // Update student
                    $.ajax({
                        url: `/students/${studentId}`,
                        method: 'PUT',
                        contentType: 'application/json',
                        data: JSON.stringify(studentData),
                        success: function() {
                            loadStudents();
                            clearForm();
                        }
                    });
                } else {
                    // Add new student
                    $.ajax({
                        url: '/students',
                        method: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify(studentData),
                        success: function() {
                            loadStudents();
                            clearForm();
                        }
                    });
                }
            });

            // Handle edit button click
            $(document).on('click', '.edit-student', function() {
                var studentId = $(this).data('id');
                $.ajax({
                    url: `/students/${studentId}`,
                    method: 'GET',
                    success: function(student) {
                        $('#student_id').val(student.student_id);
                        $('#first_name').val(student.first_name);
                        $('#last_name').val(student.last_name);
                        $('#dob').val(student.dob);
                        $('#amount_due').val(student.amount_due);
                    }
                });
            });

            // Handle delete button click
            $(document).on('click', '.delete-student', function() {
                var studentId = $(this).data('id');
                $.ajax({
                    url: `/students/${studentId}`,
                    method: 'DELETE',
                    success: function() {
                        loadStudents();
                    }
                });
            });

            // Clear form fields
            function clearForm() {
                $('#student_id').val('');
                $('#first_name').val('');
                $('#last_name').val('');
                $('#dob').val('');
                $('#amount_due').val('');
            }

            // Handle cancel update button click
            $('#cancel-update').click(function() {
                clearForm();
            });
        });
    </script>
</body>
</html>
